import pandas as pd
import numpy as np
import hashlib
import base64  
import unicodedata
import json
import os
import ast
import psycopg2
def Count_Validation_Clone(Pre_sql,Post_sql):
    conn=psycopg2.connect(
        host='',
        database='',
        user='',
        password='',
        port=

    )
    df1 = pd.read_sql(Pre_sql,conn)
    df2 = pd.read_sql(Post_sql,conn)
    result = df1.merge(df2, on="emp_status", suffixes=("_df1", "_df2"))
    result["match"] = result["employee_count_df1"] == result["employee_count_df2"]
    result[result["match"]==False]
    if result[result["match"]==False].empty:
        return "Pass"
    else:
        result=result.to_string()
        return result
def mismatch_of_record(sql):
    conn=psycopg2.connect(
        host='',
        database='',
        user='',
        password='',
        port=
    )
    df1 = pd.read_sql(sql,conn)
    df1=df1.to_string()
    return df1
def Connection_Database_Validation_Clone(Pre_sql,Post_sql):
    conn=psycopg2.connect(
        host='',
        database='',
        user='',
        password='',
        port=

    )
    df1 = pd.read_sql(Pre_sql,conn)
    df2 = pd.read_sql(Post_sql,conn)
    df1 = df1[df1['employee_type'] == "Sanofi"]
    df2 = df2[df2['employee_type'] == "Sanofi"]
    result = df1.merge(df2, on="employee_type", suffixes=("_df1", "_df2"))
    result["match"] = result["worker_count_df1"] == result["worker_count_df2"]
    return result

def Database_Connection(sql):
    conn=psycopg2.connect(
        host='',
        database='',
        user='',
        password='',
        port=
    )
    data = pd.read_sql(sql,conn)
    return data

def main():
    file_path='Scenario_Opella_Final.csv'
    df=pd.read_csv(file_path, encoding="utf-8")
    Res_Df=pd.DataFrame()
    Res_list=[]
    for index, row in df.iterrows(): 
        if(index==0):
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==1):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==2):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==3):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==4):
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==5):
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
        if(index==6):
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()})
        if(index==7):
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()})
        if(index==8):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==9):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==10):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})
        if(index==11):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==12):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==13):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==14):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==15):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==16):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==17):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==18):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==19):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==20):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==21):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==22):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==23):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==24):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==25):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==26):
            print(index)
            use_df=Connection_Database_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if(use_df['match'].iloc[0]==False):
                report=mismatch_of_record(row['Record_Mismatch_Query'])
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
        if(index==27):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()}) 
        if(index==28):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()})
        if(index==29):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':use_df.to_string()})  
        if(index==30):
            print(index)
            report=use_df=Count_Validation_Clone(row['Pre Sql'],row['Post Sql'])
            if report=='Pass':
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':' '})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':report})
        if(index==31):
            print(index)
            use_df=Database_Connection(str(row['Post Sql']))
            if use_df.empty:
                Res_list.append({'Test Case':row['Test Case'],'Status':'PASS','mismatch_of_record':'No records were found as no employee met the required criteria.'})
            else:
                Res_list.append({'Test Case':row['Test Case'],'Status':'FAIL','mismatch_of_record':use_df.to_string()})             
    Res_Df=pd.DataFrame(Res_list)
    Res_Df.to_csv('Sanity_Opella_Result.csv')
    print(Res_Df)            
if __name__ == '__main__':
    main()